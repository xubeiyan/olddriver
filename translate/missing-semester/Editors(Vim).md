# 编辑器(Vim)

> 译者：xubeiyan 校对：(正在找人来背锅)

> 译自：https://missing.csail.mit.edu/2020/editors/

写程序代码和写英文文字是完全不同的操作。当你在写程序代码时，你会花更多的时间在切换打开的文件，阅读文件，跳至文件的特定区域，编辑文件。而编写一大段文字则花不了多少时间，于是很有必要区别开写程序代码和写英文文字的程序（例如Visual Studio Code和Microsoft Word）。

作为一个程序员，我们花费了大部分的时间在写程序代码上，所以掌握一个适合你的文本编辑器就十分重要了。下面是一些学习新的文本编辑器的步骤：

- 从教程开始（例如本课程，以及我们提供的更深层次的资源）
- 在你所有需要编辑文件的时候，坚持使用此编辑器（尽管这可能一开始降低你的编辑速度）
- 随着进展而查阅资料：如果你觉得完成某件工作有更好的办法，那多半都是有的

在最初的一到两个小时之内，你可以学习如何使用编辑器打开和编辑文件，保存和退出，以及浏览和修改。在使用了20小时左右，你应该就能和用之前的编辑器一样熟练了。在此之后，好处就显现出来了：你会拥有足够的知识和肌肉记忆，而这些都可以节省你的时间。现代文本编辑是神奇而又强力的，所以你会因为在这上面投入更多时间，从而变得更加快速和熟练。

## 学哪个编辑器好？

程序员可能对于上面这个问题都有自己的看法。详见[这里](https://zh.wikipedia.org/wiki/%E7%BC%96%E8%BE%91%E5%99%A8%E4%B9%8B%E6%88%98)

那哪个文本编辑器最为流行呢？可以参考这个StackOverflow的[调查](https://insights.stackoverflow.com/survey/2019/#development-environments-and-tools)（这个调查可能不太准确，因为不是所有的程序员都会上StackOverflow）。其中[Visual Studio Code](https://code.visualstudio.com/)荣获最受欢迎的文本编辑器。而[Vim](https://www.vim.org/)则荣获最受欢迎的基于命令行的编辑器。
> 译注：VSC可能超越了文本编辑器这个范围限制，它更接近IDE这个概念

### Vim

这门课程的所有老师都使用Vim作为他们的文本编辑器。Vim历史悠久，它源自Vi编辑器。而后者直到现在仍在推出新版本。Vim有很多闪光点，所以很多其他的编辑器大都支持Vim模拟器（例如VSCode有140万用户都在用其中的Vim模拟器插件）。即使你最终选择了其他的文本编辑器，Vim仍然是值得学习的。

在这门50分钟的课程中，我们无法教给你Vim全部的功能，所以我们将精力集中于解释Vim设计的哲学，教给你基本的操作，以及给你展示一些高级功能，最后则是给予你精通这个工具的一些资源。

## Vim中的哲学

当我们在编程时，大多数的时间都是在读或者改，而不是在写。这便是Vim是一个现代编辑器的原因：因为它针对插入内容和修改内容有着不同的工作模式。

这些应用的结果则是一个满足你想象的文本编辑器。

## 编辑模式

大多数程序员的时间花在了读程序，在程序中跳转，进行小编辑，而不是在写很多代码上。Vim就根据这个特点，设计出了多种操作模式。

- Normal模式：在文件中移动和做出修改
- Insert模式：插入文本
- Replace模式：替换文本
- Visual模式（普通，行或块）：用于选中一些文本
- 命令行模式：执行某些命令

同一个按键在不同的模式下就有不同的作用。例如按键`x`在Insert模式下是插入一个字符‘x’，但在Normal模式下，它会删除光标所在位置的字符。在Visual模式下，则会删除选择的内容。

在默认的配置下，Vim会在窗口左下角显示当前的模式。默认/最初的模式是Normal模式。你接触到的最多的模式自然是Normal模式和Insert模式。

你可以在任何模式下按`<ESC>`（通常在你键盘的最左上角）来从其他模式回到Normal模式。在Normal模式中呢，我们可以通过`i`键进入Insert模式，通过`R`键进入Replace模式，通过`v`进入普通Visual模式，通过`V`进入行Visual模式，通过`C-v`（Ctrl+V，有时候表示为`^V`）进入块Visual模式，通过`:`进入命令行模式。

因为你可能要经常使用`<ESC>`键。这份[macOS下的方法](https://vim.fandom.com/wiki/Map_caps_lock_to_escape_in_macOS)可以将CapsLock键映射为Esc键。
> 译注：一般是把CapsLock键映射为左Ctrl键，这个键才是真的用得多

## 基本概念

### 插入文本

在Normal模式下，按下`i`进入Insert模式。此时的Vim就像其他的文本编辑器一样了，此时你可以按`<ESC>`返回Normal模式。掌握了这两点，你就已经会用Vim编辑文件了（虽然你一直保持在Insert模式下会有些低效）。
> 译注：当时确实记了个进入Insert模式和退出这个模式就开始用Vim了

### 缓存、标签和窗口

Vim维持着一些打开的文件，称之为“缓存”。一个Vim进程对应着多个标签（Tab），而每个标签又对应着多个窗口（分割的窗口）（Window），每个窗口对应着一个单独的缓存。但它不像其他你熟悉的程序例如浏览器，浏览器的窗口和缓存是一一对应的。而对于Vim，窗口只是一个查看的标志，一个对应的缓存可能有多个窗口，即使他们在同一个标签中。这个特性非常有用，比如，同时在两个窗口中查看编辑一个文件的两个部分。
> 译注：vim这个特性通过每个文件保存一份swp文件实现的，所以即使是多个窗口中打开同一个文件，它也会反映到同一个缓存中。很多编辑器都是这种方式。目前我知道的Notepad++，Sublime，Notepad2都是这样实现的。

默认情况下，Vim打开时保留一个标签（Tab），其中只有一个窗口（Window）。

### 命令行

可以在Normal模式下输入`:`来进入命令行模式。你会发现随着`:`的按下，光标跳到了窗口的底部。在这个模式中有值得掌握的很多功能，包括打开文件，保存文件，关闭文件，以及退出Vim。
> 译注：这是Stackoverflow上很火的一个问题：“[我要怎么退出Vim](https://stackoverflow.com/questions/11828270/how-do-i-exit-the-vim-editor/)”。这也是嘲笑Vim难学的段子

- `:q` 退出（关闭当前的窗口）
- `:w` 保存（写入write的首字母）
- `:wq` 保存并退出
- `:e {文件路径}` 打开文件以编辑
- `:ls` 显示当前的缓存
- `:help {要查找帮助的命令}` 打开帮助
	- `:help :w` 打开关于`:w`命令（保存文件）的帮助
	- `:help w` 打开关于`w`这个移动方式的帮助

## Vim的界面是可编程的

Vim中最重要的一个设计思想就是，Vim自身的界面是可编程的。你可以通过按下按键来实现功能（当然都是根据助记符来的），这些功能可以组合。这就能够有效地实现移动和编辑，尤其是形成了肌肉记忆时，特别有用。

### 移动

你应该大多数时候都处于Normal模式下，在此模式下可以使用移动命令来在屏幕上移动。在Vim中，移动通常称之为“名词（nouns）”，因为它们大多是名词的某个字符。
> 译注：这里的小写字母和大写字母是有区别的，大写字母一般按Shift+对应的字母键。因为我确实看见有人按CapsLock来切换输入的。

- 基本的移动：`hjkl`（左，下，上，右）
> 译者注：我就喜欢方向键，谁会去记啊。除了用HHKB的时候，因为HHKB的方向键需要加上Fn才能按出来
- 词组间移动：`w`（跳到下一个词），`b`（跳到下一个词组的开始），`e`（跳到下一个词组的结尾）
- 行间移动：`0`（跳到行首），`^`（跳到第一个非空白字符），`$`（跳到行尾）
> 译者注：正则表达式一般用`^`表达起始，用`$`表示结束
- 屏幕内移动：`H`（跳到屏幕顶端），`M`（跳到屏幕中间），`L`（跳到屏幕底端）
- 滚动屏幕：`Ctrl-u`（向上滚动），`Ctrl-d`（向下滚动）
- 文件内移动：`gg`（跳到文件开始），`G`（跳到文件结束）
> 译者注：这两个命令特别常用，因为打开文件的时候光标是定位于文件最开始的，想在后面追加内容时就需要按Shift+g。当然也可以在打开文件时就附加上要跳到结尾的参数`+`。例如`vim + a.txt`就会打开这个文件跳至末尾。
- 行数跳转：`:{行数}<Enter>`或者`{行数}G`（跳转到对应的行）
> 译者注：后者在默认情况下并不会显示在命令行处，所以没有反应并不要惊慌
- 杂项：`%`（移动到对应的符号处）
> 译者注：就是从`(`移动到`)`这种类似的功能
- 行查找：`f{要找的字符}`，`t{要找的字符}`，`F{要找的字符}`，`T{要找的字符}`
	- 在当前行向后查找(f,F)，向前查找(t,T)对应的字符
	- `,`和`;`用于在查找结果间跳转（前跳和后跳）
- 文件内搜索：`/{正则表达式}`，`n`和`N`在结果之间跳转
> 译者注：因为一行的内容很容易看完，但在文件中找到适当的区域就要困难得多，所以文件内搜索用得多

### 选择
> 译注：作者多半只写了个纲要，不知如何展开

Visual模式
- 常规Visual
- 行内Visual
- 块内Visual

可以使用方向键来选择文字

### 编辑

所有那些在其他编辑器需要用鼠标完成的操作，现在可以用键盘使用编辑命令和移动命令完成了。这也是Vim的界面看起来像编程语言的原因。Vim的编辑命令也被称为“动词”，因为动词大多是作用于名词上。

- `i` 进入Insert模式
	- 修改和删除文字的时候，大多数不用这个命令和退格键的组合
- `o`/`O` 在光标的下一行/上一行进入Insert模式
- `d{操作对象}` 删除{操作对象}
	- 例如`dw`为删除一个词，`d$`为从当前位置删除到行尾，`d0`为从当前位置删除到行首
- `c{操作对象}` 修改{操作对象}
	- 例如`cw`是删除当前词，并将模式改为Insert模式
	- 好比是`d{操作对象}`和`i`的连用
- `x` 删除光标所在的字符，等同于`dl`
- `s` 删除光标所在的字符并更改为Insert模式，等同`xi`
- Visual模式+选择文字
	- 选择文字，然后使用`d`来删除他们或者使用`c`来修改他们
- `u` 撤销上一次操作，`<C-r>`恢复上一次撤销的操作
- `y` 复制/“yank”（其他带`d`的操作也会复制）
> 译注：可能是作者写错了？`d`和`y`的区别是前者是剪切，后者是复制，而且复制必须在Visual模式下才能进行
- `p` 粘贴
- 其他还有很多：例如`~`，字母的大小写互换
> 译注：这个要在Visual模式下操作

### 计数操作

你可以将“名词”和“动词”的前面加上数字。这样就会执行对应的操作若干次。

- `3w` 向后跳转3个词
- `5j` 向下移动5行
- `7dw` 删除7个词

### 修饰语

你可以使用修饰语改变命令的行为。例如修饰语为`i`，则意味着在什么里面（inner或者inside），修饰语为`a`，则表示在什么周围（around）

- `ci(` 修改小括号()里面的内容
- `ci[` 修改中括号[]里面的内容
- `da'` 删除单引号及其中间的内容

## 例子

这里有一个略带错误的[fizz buzz](https://en.wikipedia.org/wiki/Fizz_buzz)小游戏的实现（`Python`代码）：

```python
def fizz_buzz(limit):
	for i in range(limit):
		if i % 3 == 0:
			print('fizz')
		if i % 5 == 0:
			print('fizz')
		if i % 3 and i % 5:
			print(i)
			
def main():
	fizz_buzz(10)
```

我们需要修正以下问题：

- 没有调用main函数
- 从0开始而不是从1开始循环
- 当数被15整除时会输出的“fizz”和“buzz”是分开的
> 译注：你只输出到第10个是不会发现这个问题的吧
- 当数被5整除时应该输出“buzz”而不是“fizz”
- 代码中使用了硬编码参数10，而不是把它放到命令行参数中

可以观看对应的课程视频的实现。可以拿在Vim上的修改和在其他编辑器上的修改作比较。可以发现Vim只需要按几个键，达到你想要的修改速度。
> 译注：有个类似的游戏，考验你完成这个问题所用的按键数最少（这是什么鬼游戏

> 译注：这里面有个两处插入`, end=''`的操作，可以在第一个`print('fizz')`中间插入之后，再按`jj`（光标向下跳动两行），再按`.`重复刚才的编辑命令

## 自定义你的Vim

我们通常修改纯文本的配置文件`~/.vimrc`来达到自定义Vim的效果（当然是使用Vimscript的命令）。这里有许许多多你想要开启的选项。

在这里我们提供了一个注释非常详细的基本配置文件，可以作为你学习Vim的开始。因为其修正了Vim的一些诡异的默认设定。点击[这里](https://missing.csail.mit.edu/2020/files/vimrc)下载这个文件，并把它保存至`~/.vimrc`。

Vim的可定制化极高，也值得花上一些时间去研究这些可以自定义的选项。你可以从Github上别人的配置文件中寻找自己想要的。例如这里有[Anish](https://github.com/anishathalye/dotfiles/blob/master/vimrc),[Jon](https://github.com/jonhoo/configs/blob/master/editor/.config/nvim/init.vim])（使用neovim）和[Jose](https://github.com/JJGO/dotfiles/blob/master/vim/.vimrc)的Vim配置文件。当然，也有很多博主的文章里面讨论这个话题。不要完全照抄别人的配置文件，而是阅读理解它，并且将它变成自己的知识。

## 扩展你的Vim

## 其他程序的Vim模式

### Shell

### Readline

### 其他

## Vim的高级用法

这里略微举例讲述Vim的强力之处。虽然我们不可能教给你全部的知识，但你可以自己动手丰衣足食。一个好的启发方式是这样的：当你使用这个编辑器然后你会想到“一定有更好的方法可以解决这个问题”，那多半都有相应的方法。在网络中找寻你的答案吧。

### 搜索与替换

### 打开多个窗口

### 使用宏

## 一些资源

- `vimtutor`是一个vim的使用手册（它随着vim一起安装）

## 练习

1. 请完成`vimtutor`。注意：这个程序似乎在80x24（80行24列）的终端窗口下工作比较好
2. 下载我们提供的[基本的vimrc](https://missing.csail.mit.edu/2020/files/vimrc)
3. 安装并配置ctrlp.vim这个插件
	1.
	2.
	3.
	4.
4.
5.
6.
7.
8.
